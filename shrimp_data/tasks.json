{
  "tasks": [
    {
      "id": "53d6f5d8-f4bf-46ed-810a-58c7c6ce39f7",
      "name": "Task 3.1: events 테이블 생성 및 RLS 정책 설정",
      "description": "Supabase에 events 테이블을 생성하고 행 수준 보안(RLS) 정책을 설정합니다.\n\n**테이블 구조**:\n- id (UUID, PK)\n- host_id (UUID, FK → profiles.id)\n- title, description, category, event_date, location\n- max_members, invite_code (UNIQUE), bank_account (JSONB), is_closed\n- created_at, updated_at (타임스탬프)\n\n**RLS 정책 (4개)**:\n1. SELECT - 호스트, 승인된 참여자만 조회\n2. SELECT - 비인증 사용자: 공개 조회 (제한)\n3. INSERT - 호스트만 생성\n4. UPDATE/DELETE - 호스트만 수정/삭제\n\n**입력/출력**:\n- 입력: Supabase 프로젝트 ID, SQL 마이그레이션\n- 출력: events 테이블 생성 확인, RLS 활성화 확인",
      "notes": "invite_code는 UNIQUE 제약으로 중복 방지. bank_account는 JSONB로 유연하게 저장. host_id는 profiles.id 참조이므로 profiles 테이블이 먼저 존재해야 함(이미 존재함).",
      "status": "in_progress",
      "dependencies": [],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:39:48.608Z",
      "relatedFiles": [
        {
          "path": "types/database.ts",
          "type": "DEPENDENCY",
          "description": "Database 타입에 events 테이블 추가 예정"
        }
      ],
      "implementationGuide": "1. Supabase 대시보드 또는 MCP 도구 사용: mcp__supabase__apply_migration\n2. CREATE TABLE events 쿼리 실행\n3. ALTER TABLE events ENABLE ROW LEVEL SECURITY\n4. CREATE POLICY for SELECT/INSERT/UPDATE/DELETE\n5. 검증: SELECT COUNT(*) FROM events (0행)\n6. RLS 정책 확인: information_schema.role_routine_grants",
      "verificationCriteria": "1. events 테이블이 Supabase 대시보드에서 확인됨\n2. RLS 정책이 활성화되어 있음\n3. 호스트가 아닌 사용자는 SELECT 결과 0행\n4. invite_code UNIQUE 제약이 적용됨\n5. 타입 생성 전 단계이므로 SQL 실행만 확인",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "a00d1817-e9f3-4947-a6e9-2f27e12beed9",
      "name": "Task 3.2: event_members 테이블 생성 및 RLS 정책 설정",
      "description": "Supabase에 event_members 테이블을 생성하고 RLS 정책을 설정합니다. 모임 참여자의 신청 상태를 관리합니다.\n\n**테이블 구조**:\n- id (UUID, PK)\n- event_id (UUID, FK → events.id, CASCADE)\n- user_id (UUID, FK → profiles.id, CASCADE)\n- status (TEXT, CHECK IN 'pending', 'approved', 'rejected', 'withdrawn')\n- memo (TEXT, 최대 500자)\n- created_at\n- UNIQUE(event_id, user_id) - 중복 신청 방지\n\n**RLS 정책 (3개)**:\n1. SELECT - 자신의 신청 또는 호스트가 조회 가능\n2. INSERT - 사용자 자신만 신청 가능\n3. UPDATE - 자신 또는 호스트만 상태 변경 가능\n\n**입력/출력**:\n- 입력: events 테이블 존재 확인\n- 출력: event_members 테이블 생성, RLS 정책 적용",
      "notes": "events 테이블이 먼저 생성되어야 함(외래키). status 상수는 lib/schemas.ts에 정의되어 있음 (pending, approved, rejected, withdrawn). UNIQUE 제약이 중복 신청 방지.",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "53d6f5d8-f4bf-46ed-810a-58c7c6ce39f7"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "lib/schemas.ts",
          "type": "REFERENCE",
          "description": "MemberStatus 타입 정의 참고"
        }
      ],
      "implementationGuide": "1. mcp__supabase__apply_migration으로 마이그레이션 실행\n2. CREATE TABLE event_members 쿼리\n3. ALTER TABLE event_members ENABLE ROW LEVEL SECURITY\n4. CREATE POLICY for SELECT/INSERT/UPDATE\n5. 외래키 CASCADE 설정 (events 삭제 시 멤버도 삭제)\n6. 검증: UNIQUE 제약 테스트 (같은 event_id, user_id 중복 삽입 시 오류)",
      "verificationCriteria": "1. event_members 테이블 생성 확인\n2. UNIQUE(event_id, user_id) 제약 적용됨\n3. RLS 정책이 활성화됨\n4. CASCADE 삭제 테스트: events 행 삭제 시 event_members도 삭제됨\n5. 비호스트 사용자는 다른 사용자의 신청 조회 불가",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "efbc7a86-053f-403f-92d3-036b3be1195b",
      "name": "Task 3.3: announcements 테이블 생성 및 RLS 정책 설정",
      "description": "Supabase에 announcements 테이블을 생성하고 RLS 정책을 설정합니다. 모임 공지사항을 관리합니다.\n\n**테이블 구조**:\n- id (UUID, PK)\n- event_id (UUID, FK → events.id, CASCADE)\n- author_id (UUID, FK → profiles.id, CASCADE)\n- title, content (TEXT)\n- is_pinned (BOOLEAN, 기본값 false - 상단 고정)\n- created_at\n\n**RLS 정책 (4개)**:\n1. SELECT - 호스트 또는 승인된 참여자만 조회\n2. INSERT - 호스트만 공지 작성 가능\n3. UPDATE - 호스트만 수정 가능 (핀 고정 포함)\n4. DELETE - 호스트만 삭제 가능\n\n**입력/출력**:\n- 입력: events 테이블 존재 확인\n- 출력: announcements 테이블 생성, RLS 정책 적용",
      "notes": "is_pinned를 통해 핵심 공지를 상단에 고정 가능. SELECT 정책이 event_members 테이블과 JOIN되므로 성능 고려. author_id는 참고용이며, 호스트 권한은 events.host_id로 검증.",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "53d6f5d8-f4bf-46ed-810a-58c7c6ce39f7"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "lib/mock-data.ts",
          "type": "REFERENCE",
          "description": "Announcement 인터페이스 구조 참고"
        }
      ],
      "implementationGuide": "1. mcp__supabase__apply_migration으로 마이그레이션 실행\n2. CREATE TABLE announcements 쿼리\n3. ALTER TABLE announcements ENABLE ROW LEVEL SECURITY\n4. CREATE POLICY for SELECT/INSERT/UPDATE/DELETE\n5. SELECT의 RLS 정책: events.host_id = auth.uid() OR event_members.status = 'approved'\n6. INSERT/UPDATE/DELETE: events.host_id = auth.uid() 확인",
      "verificationCriteria": "1. announcements 테이블 생성 확인\n2. RLS 정책이 활성화됨\n3. 호스트가 아닌 사용자는 공지 작성/수정/삭제 불가\n4. is_pinned = true인 항목이 쿼리 시 상단 정렬 확인 (ORDER BY is_pinned DESC)\n5. 비승인 참여자(status != 'approved')는 공지 조회 불가",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "56f5b4ce-044d-467c-91ff-169a7fa6c47a",
      "name": "Task 3.4: TypeScript 타입 자동 생성 및 편의 타입 추가",
      "description": "Supabase 스키마로부터 TypeScript 타입을 자동 생성하고, 프로젝트에 맞는 편의 타입을 추가합니다.\n\n**작업 단계**:\n1. `npx supabase gen types typescript > types/database.ts` 실행\n2. 생성된 파일 내용 확인 (events, event_members, announcements 포함)\n3. 파일 하단에 편의 타입 추가:\n   - Event, EventInsert, EventUpdate\n   - EventMember, MemberStatus\n   - Announcement\n4. 타입 검증: `npm run type-check` (tsc --noEmit) 오류 0건\n5. 기존 mock-data.ts의 인터페이스 vs 생성된 타입 비교\n\n**입력/출력**:\n- 입력: 3개 테이블 + RLS 정책 완료\n- 출력: types/database.ts 갱신, 편의 타입 추가",
      "notes": "자동 생성 타입이 mock-data.ts의 인터페이스와 일치해야 함. 만약 필드 불일치가 있으면 DB 스키마 재검토 필요. Tables<'table_name'> 제너릭은 기존 database.ts에 정의된 헬퍼 타입.",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "53d6f5d8-f4bf-46ed-810a-58c7c6ce39f7"
        },
        {
          "taskId": "a00d1817-e9f3-4947-a6e9-2f27e12beed9"
        },
        {
          "taskId": "efbc7a86-053f-403f-92d3-036b3be1195b"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "types/database.ts",
          "type": "TO_MODIFY",
          "description": "자동 생성 파일, 편의 타입 추가",
          "lineStart": 1,
          "lineEnd": 65
        },
        {
          "path": "lib/mock-data.ts",
          "type": "REFERENCE",
          "description": "Event, EventMember, Announcement 인터페이스 구조 비교"
        }
      ],
      "implementationGuide": "1. 터미널에서 `npx supabase gen types typescript --project-id $PROJECT_ID > types/database.ts` 실행\n2. types/database.ts 파일 열어서 Database 타입 확인\n3. 파일 끝에 편의 타입 추가:\n   ```typescript\n   export type Event = Tables<'events'>;\n   export type EventInsert = TablesInsert<'events'>;\n   export type EventMember = Tables<'event_members'>;\n   export type MemberStatus = 'pending' | 'approved' | 'rejected' | 'withdrawn';\n   export type Announcement = Tables<'announcements'>;\n   ```\n4. `npm run type-check` 실행하여 타입 오류 확인\n5. mock-data.ts의 Event, EventMember, Announcement 인터페이스와 생성된 타입 비교",
      "verificationCriteria": "1. types/database.ts에 Events, event_members, announcements 테이블 정의 포함\n2. Tables<'events'> 등 편의 타입이 정상 작동\n3. `npm run type-check` 오류 0건\n4. lib/mock-data.ts의 Event 인터페이스와 Tables<'events'>의 필드가 일치\n5. EventInsert, EventMember, MemberStatus 등 모든 편의 타입이 정의됨",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "11ec11da-3c74-4c2d-8201-5bf1d807253d",
      "name": "Task 3.5: lib/supabase/events.ts - Server 함수 구현",
      "description": "Supabase events 테이블과 상호작용하는 Server 함수를 구현합니다. Stage 4 Server Component에서 데이터 조회 시 사용될 함수들입니다.\n\n**구현 함수**:\n1. `getEventById(eventId: string)`: 모임 상세 정보 조회 (인증 필수)\n   - 호스트 또는 승인된 참여자만 조회 가능\n   - RLS 정책이 자동으로 권한 검사\n\n2. `getEventByInviteCode(inviteCode: string)`: 비인증 사용자용 공개 조회\n   - 초대 코드로 모임 정보 미리보기\n   - 기본 정보만 반환 (제목, 날짜, 장소, 최대 인원)\n\n3. `listMyHostedEvents(userId: string)`: 사용자가 주최하는 모임 목록\n   - 정렬: event_date DESC\n\n4. `listMyParticipatingEvents(userId: string)`: 사용자가 참여 중인 모임 목록\n   - WHERE status = 'approved' 필터\n   - 정렬: event_date DESC\n\n**입력/출력**:\n- 입력: lib/supabase/server.ts의 createClient() 함수\n- 출력: lib/supabase/events.ts (약 80-100줄)",
      "notes": "server.ts의 createClient()는 함수 내부에서 매번 새로 생성해야 함(Fluid compute 안내). 각 함수는 Server Component/Server Action에서만 호출 가능. getEventByInviteCode는 비인증 사용자 사용이므로 불필요한 필드 제외 고려.",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "56f5b4ce-044d-467c-91ff-169a7fa6c47a"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "lib/supabase/server.ts",
          "type": "REFERENCE",
          "description": "createClient() 함수 사용법",
          "lineStart": 12,
          "lineEnd": 37
        },
        {
          "path": "types/database.ts",
          "type": "DEPENDENCY",
          "description": "Event 타입 import"
        }
      ],
      "implementationGuide": "1. lib/supabase/events.ts 파일 생성\n2. import { createClient } from '@/lib/supabase/server'\n3. import { Event } from '@/types/database'\n4. 각 함수 구현:\n   - getEventById: `.from('events').select('*').eq('id', eventId).single()` + 에러 처리\n   - getEventByInviteCode: `.from('events').select('*').eq('invite_code', inviteCode).single()`\n   - listMyHostedEvents: `.from('events').select('*').eq('host_id', userId).order('event_date', { ascending: false })`\n   - listMyParticipatingEvents: JOIN event_members로 status='approved' 필터링\n5. 모든 함수에 try-catch 에러 처리 추가\n6. 반환 타입: Event 또는 Event[] 또는 null",
      "verificationCriteria": "1. lib/supabase/events.ts 파일이 생성됨\n2. 4개 함수 모두 구현됨 (getEventById, getEventByInviteCode, listMyHostedEvents, listMyParticipatingEvents)\n3. 모든 함수에 에러 처리 (try-catch 또는 .single() 호출 시 자동 에러) 포함\n4. 반환 타입이 Event | null 또는 Event[] 형태\n5. `npm run type-check` 오류 0건\n6. createClient() 사용이 함수 내부에서만 (전역 변수 아님)",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "4d8db485-0333-4b68-9974-54c5d95797a2",
      "name": "Task 3.6: lib/supabase/members.ts - Server 함수 구현",
      "description": "Supabase event_members 테이블과 상호작용하는 Server 함수를 구현합니다. 참여자 관리 기능을 담당합니다.\n\n**구현 함수**:\n1. `getEventMembers(eventId: string)`: 모임 참여자 목록 조회\n   - 상태별 필터링 가능 (pending, approved, rejected)\n   - 기본: 모든 상태 조회\n   - 정렬: created_at DESC\n\n2. `getMemberStatus(eventId: string, userId: string)`: 개인의 참여 상태 조회\n   - 반환: { status, memo, created_at } 또는 null\n\n3. `joinEvent(eventId: string, userId: string, memo?: string)`: 모임 참여 신청\n   - INSERT into event_members\n   - UNIQUE(event_id, user_id) 제약으로 중복 신청 방지\n   - 기존 신청이 있으면 에러\n\n4. `updateMemberStatus(eventId: string, userId: string, status: MemberStatus)`: 참여자 상태 변경 (주최자만)\n   - pending → approved, rejected, withdrawn\n   - RLS 정책으로 주최자만 가능\n\n**입력/출력**:\n- 입력: lib/supabase/server.ts의 createClient() 함수, types/database.ts의 EventMember, MemberStatus\n- 출력: lib/supabase/members.ts (약 100-120줄)",
      "notes": "joinEvent는 client component에서도 호출될 수 있으므로 에러 처리 필수. updateMemberStatus는 주최자만 호출하므로 Server Action으로 정의 권장. Stage 4에서 실제 Server Action 구현 시 이 함수 사용.",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "56f5b4ce-044d-467c-91ff-169a7fa6c47a"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "lib/supabase/server.ts",
          "type": "REFERENCE",
          "description": "createClient() 함수"
        },
        {
          "path": "types/database.ts",
          "type": "DEPENDENCY",
          "description": "EventMember, MemberStatus 타입"
        }
      ],
      "implementationGuide": "1. lib/supabase/members.ts 파일 생성\n2. import { createClient } from '@/lib/supabase/server'\n3. import { EventMember, MemberStatus } from '@/types/database'\n4. 함수 구현:\n   - getEventMembers: `.from('event_members').select('*').eq('event_id', eventId).order('created_at', { ascending: false })`\n   - getMemberStatus: `.from('event_members').select('*').eq('event_id', eventId).eq('user_id', userId).single()`\n   - joinEvent: `.from('event_members').insert({ event_id: eventId, user_id: userId, status: 'pending', memo })`\n   - updateMemberStatus: `.from('event_members').update({ status }).eq('event_id', eventId).eq('user_id', userId)`\n5. 모든 함수에 에러 처리 (중복 신청 시 UNIQUE 제약 에러 캐치 등)\n6. 반환 타입: EventMember | EventMember[] | null",
      "verificationCriteria": "1. lib/supabase/members.ts 파일이 생성됨\n2. 4개 함수 모두 구현됨\n3. joinEvent 호출 시 중복 신청 에러 처리 (UNIQUE 제약)\n4. getEventMembers에서 상태별 필터링 옵션 지원\n5. `npm run type-check` 오류 0건\n6. 모든 함수에 에러 처리 포함",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "94e4b318-541e-4287-88c2-6a4981ee0065",
      "name": "Task 3.7: lib/supabase/announcements.ts - Server 함수 구현",
      "description": "Supabase announcements 테이블과 상호작용하는 Server 함수를 구현합니다. 공지사항 관리 기능을 담당합니다.\n\n**구현 함수**:\n1. `getAnnouncements(eventId: string)`: 모임 공지 목록 조회\n   - is_pinned = true인 항목이 상단 (정렬: is_pinned DESC, created_at DESC)\n   - RLS 정책: 호스트 또는 승인된 참여자만 조회 가능\n\n2. `getAnnouncementById(id: string)`: 공지 상세 조회\n   - RLS 정책 적용됨\n\n3. `createAnnouncement(eventId: string, authorId: string, data: { title, content, is_pinned })`: 공지 작성 (주최자만)\n   - INSERT into announcements\n   - RLS 정책: 호스트만 가능\n\n4. `updateAnnouncement(id: string, data: Partial<AnnouncementData>)`: 공지 수정 (주최자만)\n   - is_pinned 토글 또는 내용 수정\n   - RLS 정책: 호스트만 가능\n\n5. `deleteAnnouncement(id: string)`: 공지 삭제 (주최자만)\n   - DELETE from announcements\n   - RLS 정책: 호스트만 가능\n\n**입력/출력**:\n- 입력: lib/supabase/server.ts의 createClient() 함수, types/database.ts의 Announcement\n- 출력: lib/supabase/announcements.ts (약 120-150줄)",
      "notes": "createAnnouncement와 updateAnnouncement, deleteAnnouncement는 주최자만 호출하므로 Server Action으로 감싸지는 것 권장 (Stage 4). getAnnouncements와 getAnnouncementById는 참여자도 조회 가능 (RLS 정책이 자동 제어).",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "56f5b4ce-044d-467c-91ff-169a7fa6c47a"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "lib/supabase/server.ts",
          "type": "REFERENCE",
          "description": "createClient() 함수"
        },
        {
          "path": "types/database.ts",
          "type": "DEPENDENCY",
          "description": "Announcement 타입"
        }
      ],
      "implementationGuide": "1. lib/supabase/announcements.ts 파일 생성\n2. import { createClient } from '@/lib/supabase/server'\n3. import { Announcement } from '@/types/database'\n4. type AnnouncementData = { title: string; content: string; is_pinned?: boolean }\n5. 함수 구현:\n   - getAnnouncements: `.from('announcements').select('*').eq('event_id', eventId).order('is_pinned', { ascending: false }).order('created_at', { ascending: false })`\n   - getAnnouncementById: `.from('announcements').select('*').eq('id', id).single()`\n   - createAnnouncement: `.from('announcements').insert({ event_id: eventId, author_id: authorId, ...data })`\n   - updateAnnouncement: `.from('announcements').update(data).eq('id', id)`\n   - deleteAnnouncement: `.from('announcements').delete().eq('id', id)`\n6. 모든 함수에 에러 처리 추가\n7. 반환 타입: Announcement | Announcement[] | null",
      "verificationCriteria": "1. lib/supabase/announcements.ts 파일이 생성됨\n2. 5개 함수 모두 구현됨\n3. getAnnouncements에서 is_pinned 우선 정렬 (DESC) 확인\n4. createAnnouncement가 유효한 AnnouncementData만 허용\n5. `npm run type-check` 오류 0건\n6. 모든 함수에 에러 처리 (RLS 위반, 권한 부족 등) 포함",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    },
    {
      "id": "81749084-7ad4-4729-98de-76aff2b8608c",
      "name": "Task 3.8: 타입 안정성 검증 및 Mock 데이터 구조 비교",
      "description": "전체 타입 시스템이 정상 작동하는지 검증하고, Mock 데이터 구조가 DB 스키마와 완전히 일치하는지 확인합니다. Stage 3 최종 검증 단계입니다.\n\n**검증 항목**:\n1. TypeScript 타입 오류 확인\n   - `npm run type-check` (tsc --noEmit) 실행 → 오류 0건\n\n2. Mock 데이터 vs DB 스키마 비교\n   - lib/mock-data.ts의 Event 인터페이스 vs Tables<'events'>\n   - EventMember 인터페이스 vs Tables<'event_members'>\n   - Announcement 인터페이스 vs Tables<'announcements'>\n   - 모든 필드가 일치하는지 확인\n\n3. Zod 스키마 vs DB 스키마 검증\n   - lib/schemas.ts의 eventCreateSchema가 Event 필드를 커버하는지 확인\n   - announcementSchema vs Announcement 필드\n\n4. Server 함수 반환 타입 검증\n   - events.ts, members.ts, announcements.ts의 모든 함수 반환 타입이 정확한지 확인\n   - 에러 처리가 적절한지 확인\n\n5. RLS 정책 실제 동작 테스트 (수동)\n   - Supabase MCP: 다양한 권한으로 테스트 (호스트, 참여자, 비인증 사용자)\n   - SELECT 결과: 권한별 데이터 노출 범위 확인\n   - INSERT/UPDATE/DELETE: 권한 없는 사용자 거절 확인\n\n**입력/출력**:\n- 입력: lib/supabase/events.ts, members.ts, announcements.ts + types/database.ts\n- 출력: 타입 검증 보고서, Stage 3 완료 체크리스트, Mock 데이터 검증 결과",
      "notes": "이 단계는 Stage 4 API 연동 전 최종 검증 역할을 합니다. 발견된 문제는 즉시 수정해야 Stage 4에서 문제 없이 진행 가능. RLS 정책 테스트는 Supabase 대시보드의 SQL Editor 또는 Supabase MCP도구 사용.",
      "status": "pending",
      "dependencies": [
        {
          "taskId": "53d6f5d8-f4bf-46ed-810a-58c7c6ce39f7"
        },
        {
          "taskId": "a00d1817-e9f3-4947-a6e9-2f27e12beed9"
        },
        {
          "taskId": "efbc7a86-053f-403f-92d3-036b3be1195b"
        },
        {
          "taskId": "56f5b4ce-044d-467c-91ff-169a7fa6c47a"
        },
        {
          "taskId": "11ec11da-3c74-4c2d-8201-5bf1d807253d"
        },
        {
          "taskId": "4d8db485-0333-4b68-9974-54c5d95797a2"
        },
        {
          "taskId": "94e4b318-541e-4287-88c2-6a4981ee0065"
        }
      ],
      "createdAt": "2026-02-25T07:38:33.482Z",
      "updatedAt": "2026-02-25T07:38:33.482Z",
      "relatedFiles": [
        {
          "path": "lib/mock-data.ts",
          "type": "REFERENCE",
          "description": "Mock 데이터 구조 비교",
          "lineStart": 9,
          "lineEnd": 47
        },
        {
          "path": "types/database.ts",
          "type": "REFERENCE",
          "description": "자동 생성된 DB 스키마 타입",
          "lineStart": 1,
          "lineEnd": 150
        },
        {
          "path": "lib/schemas.ts",
          "type": "REFERENCE",
          "description": "Zod 폼 검증 스키마",
          "lineStart": 1,
          "lineEnd": 100
        },
        {
          "path": "lib/supabase/events.ts",
          "type": "TO_MODIFY",
          "description": "Server 함수 타입 검증"
        },
        {
          "path": "lib/supabase/members.ts",
          "type": "TO_MODIFY",
          "description": "Server 함수 타입 검증"
        },
        {
          "path": "lib/supabase/announcements.ts",
          "type": "TO_MODIFY",
          "description": "Server 함수 타입 검증"
        }
      ],
      "implementationGuide": "1. `npm run type-check` 실행\n   - TypeScript 오류 발생 시 수정\n   - 모든 Server 함수의 반환 타입 확인\n\n2. lib/mock-data.ts와 types/database.ts 비교\n   - Event 인터페이스의 모든 필드가 Tables<'events'>에 있는지 확인\n   - 필드 타입이 일치하는지 확인 (string vs number, nullable vs required)\n   - 불일치 발견 시 DB 스키마 또는 Mock 데이터 수정\n\n3. Zod 스키마 검증\n   - eventCreateSchema.parse(mockEvent) 실행하여 mock 데이터가 유효한지 확인\n   - 실패 시 스키마 수정\n\n4. Server 함수 에러 처리 검증\n   - 각 함수의 try-catch 블록 확인\n   - 존재하지 않는 데이터 조회 시 null 또는 에러 반환 확인\n\n5. RLS 정책 테스트 (선택사항, Supabase MCP 사용)\n   - 호스트로 로그인 후: events, event_members 조회 가능\n   - 참여자로 로그인 후: 자신의 이벤트만 조회 가능\n   - 비인증 사용자: invite_code로 공개 조회만 가능\n   - 검증 보고서 작성\n\n6. Stage 3 완료 체크리스트 작성\n   - 모든 테이블 생성 여부\n   - RLS 정책 설정 여부\n   - 타입 생성 여부\n   - Server 함수 구현 여부\n   - 타입 검증 결과 (오류 0건)\n   - Mock 데이터 구조 일치 여부",
      "verificationCriteria": "1. `npm run type-check` 오류 0건\n2. lib/mock-data.ts의 Event, EventMember, Announcement가 생성된 타입과 완전히 일치\n3. 모든 Zod 스키마가 해당 DB 테이블 필드를 커버\n4. events.ts, members.ts, announcements.ts의 모든 함수가 정확한 타입 서명\n5. RLS 정책 테스트 완료 (선택사항)\n6. Stage 3 완료 체크리스트 문서 생성\n7. Stage 4 시작 전 최종 검증 완료",
      "analysisResult": "**Stage 3: 공통 모듈/컴포넌트 + DB 스키마 설계**\n\n**기간**: 2026-03-06 ~ 2026-03-12 (1주)\n\n**목표**: UI/UX 검증 완료 후 데이터베이스 기반 구축 및 Server 유틸리티 구현\n\n**핵심 전략**:\n1. 외래키 의존성을 고려한 테이블 생성 순서 (events → event_members, announcements)\n2. 3계층 RLS 정책 (비인증/참여자/주최자) 보안 구현\n3. 타입 안정성: 자동 생성 타입 + 편의 타입 추가\n4. Server 함수 제너릭 처리: 모든 쿼리 에러 처리 포함\n5. Mock 데이터와 DB 스키마 구조 일치 검증\n\n**기존 기반**:\n- Supabase SSR 패턴: lib/supabase/server.ts, client.ts (Server Component에서 새 클라이언트 생성)\n- Mock 데이터 구조 정의: Event, EventMember, Announcement 인터페이스\n- Zod 검증 스키마: eventCreateSchema, announcementSchema 등 완성\n\n**산출물**:\n- Supabase 데이터베이스 스키마 (events, event_members, announcements 테이블)\n- RLS 정책 SQL (각 테이블별 권한 제어)\n- types/database.ts 자동 생성 + 편의 타입\n- lib/supabase/events.ts, members.ts, announcements.ts (Server 함수)\n- Stage 3 완료 검증 체크리스트"
    }
  ]
}
